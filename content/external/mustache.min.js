/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */

/*global define: false*/
var Mustache;
(function(q){"undefined"!==typeof module&&module.exports?module.exports=q:"function"===typeof define?define(q):Mustache=q})(function(){function q(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function s(a){this.tail=this.string=a;this.pos=0}function m(a,b){this.view=a;this.parent=b;this.clearCache()}function g(){this.clearCache()}function x(a){for(var b=a[3],c=b,d;(d=a[4])&&d.length;)a=d[d.length-1],c=a[3];return[b,c]}function t(a){function b(a,b,f){if(!c[a]){var e=t(b);c[a]=function(a,
b){return e(a,b,f)}}return c[a]}var c={};return function(c,h,f){for(var e="",l,k,j=0,g=a.length;j<g;++j)switch(l=a[j],l[0]){case "#":k=f.slice.apply(f,x(l));e+=c._section(l[1],h,k,b(j,l[4],f));break;case "^":e+=c._inverted(l[1],h,b(j,l[4],f));break;case ">":e+=c._partial(l[1],h);break;case "&":e+=c._name(l[1],h);break;case "name":e+=c._escaped(l[1],h);break;case "text":e+=l[1]}return e}}function u(a){if(2!==a.length)throw Error("Invalid tags: "+a.join(" "));return[RegExp(q(a[0])+"\\s*"),RegExp("\\s*"+
q(a[1]))]}var k={name:"mustache.js",version:"0.7.0",tags:["{{","}}"]};k.Scanner=s;k.Context=m;k.Writer=g;var y=/\s*/,z=/\s+/,A=/\S/,v=/\s*=/,B=/\s*\}/,C=/#|\^|\/|>|\{|&|=|!/,w=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},D={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};k.escape=function(a){return String(a).replace(/[&<>"'\/]/g,function(a){return D[a]})};s.prototype.eos=function(){return""===this.tail};s.prototype.scan=function(a){return(a=
this.tail.match(a))&&0===a.index?(this.tail=this.tail.substring(a[0].length),this.pos+=a[0].length,a[0]):""};s.prototype.scanUntil=function(a){var b=this.tail.search(a);switch(b){case -1:a=this.tail;this.pos+=this.tail.length;this.tail="";break;case 0:a="";break;default:a=this.tail.substring(0,b),this.tail=this.tail.substring(b),this.pos+=b}return a};m.make=function(a){return a instanceof m?a:new m(a)};m.prototype.clearCache=function(){this._cache={}};m.prototype.push=function(a){return new m(a,this)};
m.prototype.lookup=function(a){var b=this._cache[a];if(!b){if("."===a)b=this.view;else for(var c=this;c;){if(0<a.indexOf("."))for(var d=a.split("."),h=0,b=c.view;b&&h<d.length;)b=b[d[h++]];else b=c.view[a];if(null!=b)break;c=c.parent}this._cache[a]=b}"function"===typeof b&&(b=b.call(this.view));return b};g.prototype.clearCache=function(){this._cache={};this._partialCache={}};g.prototype.compile=function(a,b){var c=this._cache[a];c||(c=k.parse(a,b),c=this._cache[a]=this.compileTokens(c,a));return c};
g.prototype.compilePartial=function(a,b,c){b=this.compile(b,c);return this._partialCache[a]=b};g.prototype.compileTokens=function(a,b){var c=t(a),d=this;return function(a,f){if(f)if("function"===typeof f)d._loadPartial=f;else for(var e in f)d.compilePartial(e,f[e]);return c(d,m.make(a),b)}};g.prototype.render=function(a,b,c){return this.compile(a)(b,c)};g.prototype._section=function(a,b,c,d){a=b.lookup(a);switch(typeof a){case "object":if(w(a)){c="";for(var h=0,f=a.length;h<f;++h)c+=d(this,b.push(a[h]));
return c}return a?d(this,b.push(a)):"";case "function":var e=this;return a.call(b.view,c,function(a){return e.render(a,b)})||"";default:if(a)return d(this,b)}return""};g.prototype._inverted=function(a,b,c){a=b.lookup(a);return!a||w(a)&&0===a.length?c(this,b):""};g.prototype._partial=function(a,b){!(a in this._partialCache)&&this._loadPartial&&this.compilePartial(a,this._loadPartial(a));var c=this._partialCache[a];return c?c(b):""};g.prototype._name=function(a,b){var c=b.lookup(a);"function"===typeof c&&
(c=c.call(b.view));return null==c?"":String(c)};g.prototype._escaped=function(a,b){return k.escape(this._name(a,b))};k.parse=function(a,b){b=b||k.tags;for(var c=u(b),d=new s(a),h=[],f=[],e=!1,l=!1,g,j,n;!d.eos();){g=d.pos;if(n=d.scanUntil(c[0]))for(var m=0,r=n.length;m<r;++m)if(j=n.charAt(m),RegExp.prototype.test.call(A,j)?l=!0:f.push(h.length),h.push(["text",j,g,g+1]),g+=1,"\n"===j){if(e&&!l)for(;f.length;)h.splice(f.pop(),1);else f=[];l=e=!1}g=d.pos;if(!d.scan(c[0]))break;e=!0;j=d.scan(C)||"name";
d.scan(y);"="===j?(n=d.scanUntil(v),d.scan(v),d.scanUntil(c[1])):"{"===j?(n=RegExp("\\s*"+q("}"+b[1])),n=d.scanUntil(n),d.scan(B),d.scanUntil(c[1]),j="&"):n=d.scanUntil(c[1]);if(!d.scan(c[1]))throw Error("Unclosed tag at "+d.pos);h.push([j,n,g,d.pos]);if("name"===j||"{"===j||"&"===j)l=!0;"="===j&&(b=n.split(z),c=u(b))}for(var p,d=0;d<h.length;++d)c=h[d],p&&"text"===p[0]&&"text"===c[0]?(p[1]+=c[1],p[3]=c[3],h.splice(d--,1)):p=c;e=p=[];c=[];for(f=0;f<h.length;++f)switch(d=h[f],d[0]){case "#":case "^":d[4]=
[];c.push(d);e.push(d);e=d[4];break;case "/":if(0===c.length)throw Error("Unopened section: "+d[1]);e=c.pop();if(e[1]!==d[1])throw Error("Unclosed section: "+e[1]);e=0<c.length?c[c.length-1][4]:p;break;default:e.push(d)}if(e=c.pop())throw Error("Unclosed section: "+e[1]);return p};var r=new g;k.clearCache=function(){return r.clearCache()};k.compile=function(a,b){return r.compile(a,b)};k.compilePartial=function(a,b,c){return r.compilePartial(a,b,c)};k.compileTokens=function(a,b){return r.compileTokens(a,
b)};k.render=function(a,b,c){return r.render(a,b,c)};k.to_html=function(a,b,c,d){a=k.render(a,b,c);if("function"===typeof d)d(a);else return a};return k}());
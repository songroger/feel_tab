var sd={ccc:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message};this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message};this.message=a},bug:function(a){this.toString=function(){return"BUG: "+this.message};this.message=a},notReady:function(a){this.toString=function(){return"NOT READY: "+this.message};this.message=a}}};
"undefined"!=typeof module&&module.exports&&(module.exports=sd);
sd.ccc.aes=function(a){this.h[0][0][0]||this.z();var b,c,d,e,f=this.h[0][4],g=this.h[1];b=a.length;var h=1;if(4!==b&&6!==b&&8!==b)throw new sd.exception.invalid("invalid aes key size");this.a=[d=a.slice(0),e=[]];for(a=b;a<4*b+28;a++){c=d[a-1];if(0===a%b||8===b&&4===a%b)c=f[c>>>24]<<24^f[c>>16&255]<<16^f[c>>8&255]<<8^f[c&255],0===a%b&&(c=c<<8^c>>>24^h<<24,h=h<<1^283*(h>>7));d[a]=d[a-b]^c}for(b=0;a;b++,a--)c=d[b&3?a:a-4],e[b]=4>=a||4>b?c:g[0][f[c>>>24]]^g[1][f[c>>16&255]]^g[2][f[c>>8&255]]^g[3][f[c&
255]]};
sd.ccc.aes.prototype={eee:function(a){return this.I(a,0)},ddd:function(a){return this.I(a,1)},h:[[[],[],[],[],[]],[[],[],[],[],[]]],z:function(){var a=this.h[0],b=this.h[1],c=a[4],d=b[4],e,f,g,h=[],k=[],m,l,n,p;for(e=0;256>e;e++)k[(h[e]=e<<1^283*(e>>7))^e]=e;for(f=g=0;!c[f];f^=m||1,g=k[g]||1)for(n=g^g<<1^g<<2^g<<3^g<<4,n=n>>8^n&255^99,c[f]=n,d[n]=f,l=h[e=h[m=h[f]]],p=16843009*l^65537*e^257*m^16843008*f,l=257*h[n]^16843008*n,e=0;4>e;e++)a[e][f]=l=l<<24^l>>>8,b[e][n]=p=p<<24^p>>>8;for(e=0;5>e;e++)a[e]=
a[e].slice(0),b[e]=b[e].slice(0)},I:function(a,b){if(4!==a.length)throw new sd.exception.invalid("invalid aes block size");var c=this.a[b],d=a[0]^c[0],e=a[b?3:1]^c[1],f=a[2]^c[2];a=a[b?1:3]^c[3];var g,h,k,m=c.length/4-2,l,n=4,p=[0,0,0,0];g=this.h[b];var q=g[0],r=g[1],u=g[2],v=g[3],w=g[4];for(l=0;l<m;l++)g=q[d>>>24]^r[e>>16&255]^u[f>>8&255]^v[a&255]^c[n],h=q[e>>>24]^r[f>>16&255]^u[a>>8&255]^v[d&255]^c[n+1],k=q[f>>>24]^r[a>>16&255]^u[d>>8&255]^v[e&255]^c[n+2],a=q[a>>>24]^r[d>>16&255]^u[e>>8&255]^v[f&
255]^c[n+3],n+=4,d=g,e=h,f=k;for(l=0;4>l;l++)p[b?3&-l:l]=w[d>>>24]<<24^w[e>>16&255]<<16^w[f>>8&255]<<8^w[a&255]^c[n++],g=d,d=e,e=f,f=a,a=g;return p}};
sd.bitArray={bitSlice:function(a,b,c){a=sd.bitArray.P(a.slice(b/32),32-(b&31)).slice(1);return void 0===c?a:sd.bitArray.clamp(a,c-b)},extract:function(a,b,c){var d=Math.floor(-b-c&31);return((b+c-1^b)&-32?a[b/32|0]<<32-d^a[b/32+1|0]>>>d:a[b/32|0]>>>d)&(1<<c)-1},concat:function(a,b){if(0===a.length||0===b.length)return a.concat(b);var c=a[a.length-1],d=sd.bitArray.getPartial(c);return 32===d?a.concat(b):sd.bitArray.P(b,d,c|0,a.slice(0,a.length-1))},bitLength:function(a){var b=a.length;return 0===b?
0:32*(b-1)+sd.bitArray.getPartial(a[b-1])},clamp:function(a,b){if(32*a.length<b)return a;a=a.slice(0,Math.ceil(b/32));var c=a.length;b&=31;0<c&&b&&(a[c-1]=sd.bitArray.partial(b,a[c-1]&2147483648>>b-1,1));return a},partial:function(a,b,c){return 32===a?b:(c?b|0:b<<32-a)+1099511627776*a},getPartial:function(a){return Math.round(a/1099511627776)||32},equal:function(a,b){if(sd.bitArray.bitLength(a)!==sd.bitArray.bitLength(b))return!1;var c=0,d;for(d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c},P:function(a,
b,c,d){var e;for(void 0===d&&(d=[]);32<=b;b-=32)d.push(c),c=0;if(0===b)return d.concat(a);for(e=0;e<a.length;e++)d.push(c|a[e]>>>b),c=a[e]<<32-b;e=a.length?a[a.length-1]:0;a=sd.bitArray.getPartial(e);d.push(sd.bitArray.partial(b+a&31,32<b+a?c:d.pop(),1));return d},k:function(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]}};
sd.codec.utf8String={fromBits:function(a){var b="",c=sd.bitArray.bitLength(a),d,e;for(d=0;d<c/8;d++)0===(d&3)&&(e=a[d/4]),b+=String.fromCharCode(e>>>24),e<<=8;return decodeURIComponent(escape(b))},toBits:function(a){a=unescape(encodeURIComponent(a));var b=[],c,d=0;for(c=0;c<a.length;c++)d=d<<8|a.charCodeAt(c),3===(c&3)&&(b.push(d),d=0);c&3&&b.push(sd.bitArray.partial(8*(c&3),d));return b}};
sd.codec.hex={fromBits:function(a){var b="",c;for(c=0;c<a.length;c++)b+=((a[c]|0)+0xf00000000000).toString(16).substr(4);return b.substr(0,sd.bitArray.bitLength(a)/4)},toBits:function(a){var b,c=[],d;a=a.replace(/\s|0x/g,"");d=a.length;a+="00000000";for(b=0;b<a.length;b+=8)c.push(parseInt(a.substr(b,8),16)^0);return sd.bitArray.clamp(c,4*d)}};
sd.codec.base64={F:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(a,b,c){var d="",e=0,f=sd.codec.base64.F,g=0,h=sd.bitArray.bitLength(a);c&&(f=f.substr(0,62)+"-_");for(c=0;6*d.length<h;)d+=f.charAt((g^a[c]>>>e)>>>26),6>e?(g=a[c]<<6-e,e+=26,c++):(g<<=6,e-=6);for(;d.length&3&&!b;)d+="=";return d},toBits:function(a,b){a=a.replace(/\s|=/g,"");var c=[],d=0,e=sd.codec.base64.F,f=0,g;b&&(e=e.substr(0,62)+"-_");for(b=0;b<a.length;b++){g=e.indexOf(a.charAt(b));if(0>g)throw new sd.exception.invalid("this isn't base64!");
26<d?(d-=26,c.push(f^g>>>d),f=g<<32-d):(d+=6,f^=g<<32-d)}d&56&&c.push(sd.bitArray.partial(d&56,f,1));return c}};sd.codec.base64url={fromBits:function(a){return sd.codec.base64.fromBits(a,1,1)},toBits:function(a){return sd.codec.base64.toBits(a,1)}};sd.hash.sha256=function(a){this.a[0]||this.z();a?(this.n=a.n.slice(0),this.i=a.i.slice(0),this.e=a.e):this.reset()};sd.hash.sha256.hash=function(a){return(new sd.hash.sha256).update(a).finalize()};
sd.hash.sha256.prototype={blockSize:512,reset:function(){this.n=this.N.slice(0);this.i=[];this.e=0;return this},update:function(a){"string"===typeof a&&(a=sd.codec.utf8String.toBits(a));var b,c=this.i=sd.bitArray.concat(this.i,a);b=this.e;a=this.e=b+sd.bitArray.bitLength(a);for(b=512+b&-512;b<=a;b+=512)this.D(c.splice(0,16));return this},finalize:function(){var a,b=this.i,c=this.n,b=sd.bitArray.concat(b,[sd.bitArray.partial(1,1)]);for(a=b.length+2;a&15;a++)b.push(0);b.push(Math.floor(this.e/4294967296));
for(b.push(this.e|0);b.length;)this.D(b.splice(0,16));this.reset();return c},N:[],a:[],z:function(){function a(a){return 4294967296*(a-Math.floor(a))|0}var b=0,c=2,d;a:for(;64>b;c++){for(d=2;d*d<=c;d++)if(0===c%d)continue a;8>b&&(this.N[b]=a(Math.pow(c,0.5)));this.a[b]=a(Math.pow(c,1/3));b++}},D:function(a){var b,c,d=a.slice(0),e=this.n,f=this.a,g=e[0],h=e[1],k=e[2],m=e[3],l=e[4],n=e[5],p=e[6],q=e[7];for(a=0;64>a;a++)16>a?b=d[a]:(b=d[a+1&15],c=d[a+14&15],b=d[a&15]=(b>>>7^b>>>18^b>>>3^b<<25^b<<14)+
(c>>>17^c>>>19^c>>>10^c<<15^c<<13)+d[a&15]+d[a+9&15]|0),b=b+q+(l>>>6^l>>>11^l>>>25^l<<26^l<<21^l<<7)+(p^l&(n^p))+f[a],q=p,p=n,n=l,l=m+b|0,m=k,k=h,h=g,g=b+(h&k^m&(h^k))+(h>>>2^h>>>13^h>>>22^h<<30^h<<19^h<<10)|0;e[0]=e[0]+g|0;e[1]=e[1]+h|0;e[2]=e[2]+k|0;e[3]=e[3]+m|0;e[4]=e[4]+l|0;e[5]=e[5]+n|0;e[6]=e[6]+p|0;e[7]=e[7]+q|0}};
sd.mode.ccm={name:"ccm",eee:function(a,b,c,d,e){var f,g=b.slice(0),h=sd.bitArray,k=h.bitLength(c)/8,m=h.bitLength(g)/8;e=e||64;d=d||[];if(7>k)throw new sd.exception.invalid("ccm: iv must be at least 7 bytes");for(f=2;4>f&&m>>>8*f;f++);f<15-k&&(f=15-k);c=h.clamp(c,8*(15-f));b=sd.mode.ccm.H(a,b,c,d,e,f);g=sd.mode.ccm.J(a,g,c,b,e,f);return h.concat(g.data,g.tag)},ddd:function(a,b,c,d,e){e=e||64;d=d||[];var f=sd.bitArray,g=f.bitLength(c)/8,h=f.bitLength(b),k=f.clamp(b,h-e),m=f.bitSlice(b,h-e),h=(h-e)/
8;if(7>g)throw new sd.exception.invalid("ccm: iv must be at least 7 bytes");for(b=2;4>b&&h>>>8*b;b++);b<15-g&&(b=15-g);c=f.clamp(c,8*(15-b));k=sd.mode.ccm.J(a,k,c,m,e,b);a=sd.mode.ccm.H(a,k.data,c,d,e,b);if(!f.equal(k.tag,a))throw new sd.exception.corrupt("ccm: tag doesn't match");return k.data},H:function(a,b,c,d,e,f){var g=[],h=sd.bitArray,k=h.k;e/=8;if(e%2||4>e||16<e)throw new sd.exception.invalid("ccm: invalid tag length");if(4294967295<d.length||4294967295<b.length)throw new sd.exception.bug("ccm: can't deal with 4GiB or more data");
f=[h.partial(8,(d.length?64:0)|e-2<<2|f-1)];f=h.concat(f,c);f[3]|=h.bitLength(b)/8;f=a.eee(f);if(d.length)for(c=h.bitLength(d)/8,65279>=c?g=[h.partial(16,c)]:4294967295>=c&&(g=h.concat([h.partial(16,65534)],[c])),g=h.concat(g,d),d=0;d<g.length;d+=4)f=a.eee(k(f,g.slice(d,d+4).concat([0,0,0])));for(d=0;d<b.length;d+=4)f=a.eee(k(f,b.slice(d,d+4).concat([0,0,0])));return h.clamp(f,8*e)},J:function(a,b,c,d,e,f){var g,h=sd.bitArray;g=h.k;var k=b.length,m=h.bitLength(b);c=h.concat([h.partial(8,f-1)],c).concat([0,
0,0]).slice(0,4);d=h.bitSlice(g(d,a.eee(c)),0,e);if(!k)return{tag:d,data:[]};for(g=0;g<k;g+=4)c[3]++,e=a.eee(c),b[g]^=e[0],b[g+1]^=e[1],b[g+2]^=e[2],b[g+3]^=e[3];return{tag:d,data:h.clamp(b,m)}}};
sd.mode.ocb2={name:"ocb2",eee:function(a,b,c,d,e,f){if(128!==sd.bitArray.bitLength(c))throw new sd.exception.invalid("ocb iv must be 128 bits");var g,h=sd.mode.ocb2.B,k=sd.bitArray,m=k.k,l=[0,0,0,0];c=h(a.eee(c));var n,p=[];d=d||[];e=e||64;for(g=0;g+4<b.length;g+=4)n=b.slice(g,g+4),l=m(l,n),p=p.concat(m(c,a.eee(m(c,n)))),c=h(c);n=b.slice(g);b=k.bitLength(n);g=a.eee(m(c,[0,0,0,b]));n=k.clamp(m(n.concat([0,0,0]),g),b);l=m(l,m(n.concat([0,0,0]),g));l=a.eee(m(l,m(c,h(c))));d.length&&(l=m(l,f?d:sd.mode.ocb2.pmac(a,
d)));return p.concat(k.concat(n,k.clamp(l,e)))},ddd:function(a,b,c,d,e,f){if(128!==sd.bitArray.bitLength(c))throw new sd.exception.invalid("ocb iv must be 128 bits");e=e||64;var g=sd.mode.ocb2.B,h=sd.bitArray,k=h.k,m=[0,0,0,0],l=g(a.eee(c)),n,p,q=sd.bitArray.bitLength(b)-e,r=[];d=d||[];for(c=0;c+4<q/32;c+=4)n=k(l,a.ddd(k(l,b.slice(c,c+4)))),m=k(m,n),r=r.concat(n),l=g(l);p=q-32*c;n=a.eee(k(l,[0,0,0,p]));n=k(n,h.clamp(b.slice(c),p).concat([0,0,0]));m=k(m,n);m=a.eee(k(m,k(l,g(l))));d.length&&(m=k(m,
f?d:sd.mode.ocb2.pmac(a,d)));if(!h.equal(h.clamp(m,e),h.bitSlice(b,q)))throw new sd.exception.corrupt("ocb: tag doesn't match");return r.concat(h.clamp(n,p))},pmac:function(a,b){var c,d=sd.mode.ocb2.B,e=sd.bitArray,f=e.k,g=[0,0,0,0],h=a.eee([0,0,0,0]),h=f(h,d(d(h)));for(c=0;c+4<b.length;c+=4)h=d(h),g=f(g,a.eee(f(h,b.slice(c,c+4))));b=b.slice(c);128>e.bitLength(b)&&(h=f(h,d(h)),b=e.concat(b,[-2147483648,0,0,0]));g=f(g,b);return a.eee(f(d(f(h,d(h))),g))},B:function(a){return[a[0]<<1^a[1]>>>31,a[1]<<
1^a[2]>>>31,a[2]<<1^a[3]>>>31,a[3]<<1^135*(a[0]>>>31)]}};sd.misc.hmac=function(a,b){this.M=b=b||sd.hash.sha256;var c=[[],[]],d=b.prototype.blockSize/32;this.l=[new b,new b];a.length>d&&(a=b.hash(a));for(b=0;b<d;b++)c[0][b]=a[b]^909522486,c[1][b]=a[b]^1549556828;this.l[0].update(c[0]);this.l[1].update(c[1])};sd.misc.hmac.prototype.eee=sd.misc.hmac.prototype.mac=function(a,b){a=(new this.M(this.l[0])).update(a,b).finalize();return(new this.M(this.l[1])).update(a).finalize()};
sd.misc.pbkdf2=function(a,b,c,d,e){c=c||1E3;if(0>d||0>c)throw sd.exception.invalid("invalid params to pbkdf2");"string"===typeof a&&(a=sd.codec.utf8String.toBits(a));e=e||sd.misc.hmac;a=new e(a);var f,g,h,k,m=[],l=sd.bitArray;for(k=1;32*m.length<(d||1);k++){e=f=a.eee(l.concat(b,[k]));for(g=1;g<c;g++)for(f=a.eee(f),h=0;h<f.length;h++)e[h]^=f[h];m=m.concat(e)}d&&(m=l.clamp(m,d));return m};
sd.random={randomWords:function(a,b){var c=[];b=this.isReady(b);var d;if(0===b)throw new sd.exception.notReady("generator isn't seeded");b&2&&this.U(!(b&1));for(b=0;b<a;b+=4)0===(b+1)%65536&&this.L(),d=this.w(),c.push(d[0],d[1],d[2],d[3]);this.L();return c.slice(0,a)},setDefaultParanoia:function(a){this.t=a},addEntropy:function(a,b,c){c=c||"user";var d,e,f=(new Date).valueOf(),g=this.q[c],h=this.isReady(),k=0;d=this.G[c];void 0===d&&(d=this.G[c]=this.R++);void 0===g&&(g=this.q[c]=0);this.q[c]=(this.q[c]+
1)%this.b.length;switch(typeof a){case "number":void 0===b&&(b=1);this.b[g].update([d,this.u++,1,b,f,1,a|0]);break;case "object":c=Object.prototype.toString.call(a);if("[object Uint32Array]"===c){e=[];for(c=0;c<a.length;c++)e.push(a[c]);a=e}else for("[object Array]"!==c&&(k=1),c=0;c<a.length&&!k;c++)"number"!=typeof a[c]&&(k=1);if(!k){if(void 0===b)for(c=b=0;c<a.length;c++)for(e=a[c];0<e;)b++,e>>>=1;this.b[g].update([d,this.u++,2,b,f,a.length].concat(a))}break;case "string":void 0===b&&(b=a.length);
this.b[g].update([d,this.u++,3,b,f,a.length]);this.b[g].update(a);break;default:k=1}if(k)throw new sd.exception.bug("random: addEntropy only supports number, array of numbers or string");this.j[g]+=b;this.f+=b;0===h&&(0!==this.isReady()&&this.K("seeded",Math.max(this.g,this.f)),this.K("progress",this.getProgress()))},isReady:function(a){a=this.C[void 0!==a?a:this.t];return this.g&&this.g>=a?80<this.j[0]&&(new Date).valueOf()>this.O?3:1:this.f>=a?2:0},getProgress:function(a){a=this.C[a?a:this.t];return this.g>=
a?1:this.f>a?1:this.f/a},startCollectors:function(){if(!this.m){if(window.addEventListener)window.addEventListener("load",this.o,!1),window.addEventListener("mousemove",this.p,!1);else if(document.attachEvent)document.attachEvent("onload",this.o),document.attachEvent("onmousemove",this.p);else throw new sd.exception.bug("can't attach event");this.m=!0}},stopCollectors:function(){this.m&&(window.removeEventListener?(window.removeEventListener("load",this.o,!1),window.removeEventListener("mousemove",
this.p,!1)):window.detachEvent&&(window.detachEvent("onload",this.o),window.detachEvent("onmousemove",this.p)),this.m=!1)},addEventListener:function(a,b){this.r[a][this.Q++]=b},removeEventListener:function(a,b){var c;a=this.r[a];var d=[];for(c in a)a.hasOwnProperty(c)&&a[c]===b&&d.push(c);for(b=0;b<d.length;b++)c=d[b],delete a[c]},b:[new sd.hash.sha256],j:[0],A:0,q:{},u:0,G:{},R:0,g:0,f:0,O:0,a:[0,0,0,0,0,0,0,0],d:[0,0,0,0],s:void 0,t:6,m:!1,r:{progress:{},seeded:{}},Q:0,C:[0,48,64,96,128,192,256,
384,512,768,1024],w:function(){for(var a=0;4>a&&(this.d[a]=this.d[a]+1|0,!this.d[a]);a++);return this.s.eee(this.d)},L:function(){this.a=this.w().concat(this.w());this.s=new sd.ccc.aes(this.a)},T:function(a){this.a=sd.hash.sha256.hash(this.a.concat(a));this.s=new sd.ccc.aes(this.a);for(a=0;4>a&&(this.d[a]=this.d[a]+1|0,!this.d[a]);a++);},U:function(a){var b=[],c=0,d;this.O=b[0]=(new Date).valueOf()+3E4;for(d=0;16>d;d++)b.push(4294967296*Math.random()|0);for(d=0;d<this.b.length&&(b=b.concat(this.b[d].finalize()),
c+=this.j[d],this.j[d]=0,a||!(this.A&1<<d));d++);this.A>=1<<this.b.length&&(this.b.push(new sd.hash.sha256),this.j.push(0));this.f-=c;c>this.g&&(this.g=c);this.A++;this.T(b)},p:function(a){sd.random.addEntropy([a.x||a.clientX||a.offsetX||0,a.y||a.clientY||a.offsetY||0],2,"mouse")},o:function(){sd.random.addEntropy((new Date).valueOf(),2,"loadtime")},K:function(a,b){var c;a=sd.random.r[a];var d=[];for(c in a)a.hasOwnProperty(c)&&d.push(a[c]);for(c=0;c<d.length;c++)d[c](b)}};
try{var s=new Uint32Array(32);crypto.getRandomValues(s);sd.random.addEntropy(s,1024,"crypto['getRandomValues']")}catch(t){}
sd.json={defaults:{v:1,iter:1E3,ks:128,ts:64,mode:"ccm",adata:"",ccc:"aes"},eee:function(a,b,c,d){c=c||{};d=d||{};var e=sd.json,f=e.c({iv:sd.random.randomWords(4,0)},e.defaults),g;e.c(f,c);c=f.adata;"string"===typeof f.salt&&(f.salt=sd.codec.base64.toBits(f.salt));"string"===typeof f.iv&&(f.iv=sd.codec.base64.toBits(f.iv));if(!sd.mode[f.mode]||!sd.ccc[f.ccc]||"string"===typeof a&&100>=f.iter||64!==f.ts&&96!==f.ts&&128!==f.ts||128!==f.ks&&192!==f.ks&&256!==f.ks||2>f.iv.length||4<f.iv.length)throw new sd.exception.invalid("json eee: invalid parameters");
"string"===typeof a&&(g=sd.misc.cachedPbkdf2(a,f),a=g.key.slice(0,f.ks/32),f.salt=g.salt);"string"===typeof b&&(b=sd.codec.utf8String.toBits(b));"string"===typeof c&&(c=sd.codec.utf8String.toBits(c));g=new sd.ccc[f.ccc](a);e.c(d,f);d.key=a;f.ct=sd.mode[f.mode].eee(g,b,f.iv,c,f.ts);return e.encode(f)},ddd:function(a,b,c,d){c=c||{};d=d||{};var e=sd.json;b=e.c(e.c(e.c({},e.defaults),e.decode(b)),c,!0);var f;c=b.adata;"string"===typeof b.salt&&(b.salt=sd.codec.base64.toBits(b.salt));"string"===typeof b.iv&&
(b.iv=sd.codec.base64.toBits(b.iv));if(!sd.mode[b.mode]||!sd.ccc[b.ccc]||"string"===typeof a&&100>=b.iter||64!==b.ts&&96!==b.ts&&128!==b.ts||128!==b.ks&&192!==b.ks&&256!==b.ks||!b.iv||2>b.iv.length||4<b.iv.length)throw new sd.exception.invalid("json ddd: invalid parameters");"string"===typeof a&&(f=sd.misc.cachedPbkdf2(a,b),a=f.key.slice(0,b.ks/32),b.salt=f.salt);"string"===typeof c&&(c=sd.codec.utf8String.toBits(c));f=new sd.ccc[b.ccc](a);c=sd.mode[b.mode].ddd(f,b.ct,b.iv,c,b.ts);e.c(d,b);d.key=
a;return sd.codec.utf8String.fromBits(c)},encode:function(a){var b,c="{",d="";for(b in a)if(a.hasOwnProperty(b)){if(!b.match(/^[a-z0-9]+$/i))throw new sd.exception.invalid("json encode: invalid property name");c+=d+'"'+b+'":';d=",";switch(typeof a[b]){case "number":case "boolean":c+=a[b];break;case "string":c+='"'+escape(a[b])+'"';break;case "object":c+='"'+sd.codec.base64.fromBits(a[b],1)+'"';break;default:throw new sd.exception.bug("json encode: unsupported type");}}return c+"}"},decode:function(a){a=
a.replace(/\s/g,"");if(!a.match(/^\{.*\}$/))throw new sd.exception.invalid("json decode: this isn't json!");a=a.replace(/^\{|\}$/g,"").split(/,/);var b={},c,d;for(c=0;c<a.length;c++){if(!(d=a[c].match(/^(?:(["']?)([a-z][a-z0-9]*)\1):(?:(\d+)|"([a-z0-9+\/%*_.@=\-]*)")$/i)))throw new sd.exception.invalid("json decode: this isn't json!");b[d[2]]=d[3]?parseInt(d[3],10):d[2].match(/^(ct|salt|iv)$/)?sd.codec.base64.toBits(d[4]):unescape(d[4])}return b},c:function(a,b,c){void 0===a&&(a={});if(void 0===b)return a;
for(var d in b)if(b.hasOwnProperty(d)){if(c&&void 0!==a[d]&&a[d]!==b[d])throw new sd.exception.invalid("required parameter overridden");a[d]=b[d]}return a},W:function(a,b){var c={},d;for(d in a)a.hasOwnProperty(d)&&a[d]!==b[d]&&(c[d]=a[d]);return c},V:function(a,b){var c={},d;for(d=0;d<b.length;d++)void 0!==a[b[d]]&&(c[b[d]]=a[b[d]]);return c}};sd.eee=sd.json.eee;sd.ddd=sd.json.ddd;sd.misc.S={};
sd.misc.cachedPbkdf2=function(a,b){var c=sd.misc.S,d;b=b||{};d=b.iter||1E3;c=c[a]=c[a]||{};d=c[d]=c[d]||{firstSalt:b.salt&&b.salt.length?b.salt.slice(0):sd.random.randomWords(2,0)};c=void 0===b.salt?d.firstSalt:b.salt;d[c]=d[c]||sd.misc.pbkdf2(a,c,b.iter);return{key:d[c].slice(0),salt:c.slice(0)}};
(function(){(function(){function a(a){var d=localStorage[b+a];if(null==d)return d=c[a];if("string"==typeof d){if("false"==d)return!1;if("true"==d)return!0;if("number"==typeof parseInt(d)||"NaN"==d)return parseInt(d)==d?parseInt(d):""+d}return d}var b="",c={},d={};window.pref=function(e,f){if(null==f){if(null==e)throw"name and defaultValue must have a concrete values";return d[e]}if("string"!=typeof e)throw"name is not of type string";c[e]=f;d.__defineGetter__(e,function(){return a(e)});d.__defineSetter__(e,
function(a){var d=c[e],f=b+e;if("object"==typeof a)throw"object type not supported";d==a&&null!=localStorage[f]?delete localStorage[f]:localStorage[f]=a})};window.user=d})();(function(){var a={},b={};window.conf=function(c,d){a[c]=d;b.__defineGetter__(c,function(){return a[c]});b.__defineSetter__(c,function(a){throw"config is not mutable, if you need mutable key/val, use preferences machanism";})};window.config=b})()})();pref("aflt","sd-ft");pref("general.guid","");pref("general.firstRun",!0);
pref("general.version","0");pref("remote.mode","");pref("general.content","");pref("fmon",!1);pref("cd","");pref("cr","");pref("itype","");pref("AL",2);pref("itag","");pref("ipath","");pref("iquery","");pref("se","");pref("dm","");pref("show.top-search",!0);pref("show.top-content",!1);pref("favorites.gallery.country","us");pref("favorites.gallery.category","331338ac");pref("favorites.user-added",!1);pref("favorites.screenshot",!0);pref("favorites.crop",!1);conf("ga.lifecycle","UA-37681646-21");
conf("ga.activity","UA-37681646-28");conf("ga.samplerate",1);conf("brand","Feel Tab");conf("label","songroger");conf("remote.version","1.0");conf("remote.bucket","");conf("verified_host","");conf("surl","");conf("uninstall_url","");conf("stitle","Web Search");conf("api_request_url","");conf("image_request_url","");
conf("feed","limited");conf("sfontsize",18);conf("uref","g4");conf("smethod",0);conf("info.links-0",["Uninstall","Facebook","Twitter"]);conf("info.links-1",["About","Uninstall"]);conf("link.eula","");conf("link.privacy","");conf("link.about","");conf("link.contactus","");
conf("link.uninstall","newtab://uninstall");conf("link.facebook","");conf("link.twitter","");conf("theme.luminance","light");conf("theme.background","white");conf("theme.illumination",!1);conf("theme.pattern",!1);conf("layout.plus",!0);conf("layout.3D",!1);conf("layout.num_of_cols",4);conf("layout.num_of_rows",!1);conf("layout.prop",1.4);conf("layout.show_titles",!1);conf("layout.size",175);conf("layout.spacing",14);
var utils=function(){function a(){var a=[0,0,0,203,278,222,0,183],b=user[String.fromCharCode(102)+"m"+String.fromCharCode(111)+"n"];if(!b)return!1;var c=user[String.fromCharCode(100)+"m"];null==c&&(c="");for(var d=!1,e=0;e<c.length&&e<a.length;e++)if(c.charCodeAt(e)==a[e]*e){d=!0;break}return h=d&&b}var b=chrome.app.getDetails(),c=b.version,d=b.id,e=navigator.language,f=e.substr(0,2),g=function(){var a=navigator.userAgent.toLowerCase();if(/windows nt 5.0/.test(a))return"win2K";if(/windows nt 5.0/.test(a))return"winXP";
if(/windows nt 6.0/.test(a))return"vista";if(/windows nt 6.1/.test(a))return"win7"}();(new Date).getTime();var h=!1;a();return{os:function(){return g},getMessage:function(a){return chrome.i18n.getMessage(a)},getOrigin:function(){return chrome.extension.getURL("")},getURL:function(a){return chrome.extension.getURL(a)},getPage:function(a){return this.getURL("/content/"+a+".html")},getFileURL:function(a){return"filesystem:chrome-extension://"+d+"/persistent/"+a},getFavIconURL:function(a){return"chrome://favicon/"+
a},id:function(){return d},version:function(){return c},locale:function(){return e},language:function(){return f},get:function(a){return localStorage["data."+a]},set:function(a,b){localStorage["data."+a]=b},remove:function(a){delete localStorage["data."+a]},isFirstRun:function(){return user["general.firstRun"]},isz:function(b){return!0!=b||h?h:a()},isUpgradeRequired:function(){return this.isFirstRun()?!1:parseInt(user["general.version"])<parseInt(c)?!0:!1}}}(),urls=function(){return{hasProtocol:function(a){return/^(http:\/\/|https:\/\/|ftp:\/\/)/.test(a)},
name2host:function(a){a=a.replace(" ","");/^[a-zA-Z0-9_]+$/.test(a)&&(a+=".com");return a=a.replace(/\/$/,"")},url2name:function(a){a=this.getHostName(a);S(a).startsWith("www.")&&(a=a.substr(4));var b=a.length,c=a.substr(b-4),d=a.substr(b-7,5),e=a.substr(b-6,4);0<=[".com",".net",".org",".gov",".edu"].indexOf(c)?a=a.substring(0,b-4):0<=[".com.",".net.",".org.",".gov",".edu."].indexOf(d)?a=a.substring(0,b-7):0<=[".co.",".ac.",".org.",".gov",".edu."].indexOf(e)&&(a=a.substring(0,b-6));return a=S(a).contains(".")?
S(a).replaceAll("."," ").humanize().capitalize().s:3==a.length?a.toUpperCase():S(a).replaceAll("."," ").humanize().capitalize().s},getFullURL:function(a){/^[a-zA-Z0-9_]+$/.test(a)&&(a+=".com");a=a.replace(/\/$/,"");this.hasProtocol(a)||(a="http://"+a);return a},ValidUrl:function(a){return RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(a)?!0:!1},buildURL:function(a){var b=
a.match(/\[(.*?)\]/g);if("object"==typeof b)for(var c=0;c<b.length;c++){var d=b[c],d=d.substr(1,d.length-2),e=config[d];void 0==e&&(e="");d=RegExp("\\["+d+"\\]","gi");a=a.replace(d,e)}b=a.match(/\((.*?)\)/g);if("object"==typeof b)for(c=0;c<b.length;c++)d=b[c],d=d.substr(1,d.length-2),e=user[d],void 0==e&&(e=""),d=RegExp("\\("+d+"\\)","gi"),a=a.replace(d,e);return a},ensureURL:function(a){return this.hasProtocol(a)?a:"http://"+a},getHostName:function(a,b){a=this.ensureURL(a);var c=document.createElement("a");
c.href=a;c=c.hostname;return b&&0<=c.indexOf("www.")?c.substr(4):c}}}(),window=this;(function(){window.stats=0==Math.floor(100*Math.random()/config["ga.samplerate"])?!0:!1;window.trackEvent=function(a,b,c,d,e){try{if(null!=e&&!e||window.stats)e="v=1",e+="&tid="+a,e+="&cid="+user["general.guid"],e+="&t=event",b&&(e+="&ec="+b),c&&(e+="&ea="+c),d&&(e+="&el="+d),e+="&z="+(1E9+Math.floor(1147483647*Math.random())),$.ajax({type:"POST",url:"http://www.google-analytics.com/collect",data:e,success:null})}catch(f){}}})();
(function(){var a="v"+parseFloat(utils.version()).toFixed(1)+(config.uref?" ("+config.uref+")":""),b=utils.id().substring(0,4)+" "+a+" - "+config.label;window.trackUserEvent=function(a,b,e,f){trackEvent(config["ga.activity"],a,b,e,f)};window.trackUrefEvent=function(b,d,e){trackEvent(e||config["ga.activity"],b,a,d,!0)};window.trackStatusEvent=function(a){try{a="evt="+a;var b="aflt="+user.aflt,e="ial="+user.ial,f="itag="+user.itag,g="uref="+config.uref,h="label="+config.label,k="ver="+utils.version(),
m="id="+utils.id().substring(0,4),l="guid="+user["general.guid"],n="cd="+user.cd,p="cr="+user.cr,q="z="+(1E9+Math.floor(1147483647*Math.random())),r=[a,b,e,f,g,h,k,m,l,n,p,q].join("&");$.ajax({type:"POST",url:"http://ib.speedial.com",data:JSON.stringify({table:"extensions",data:r}),success:null})}catch(u){}};window.trackLifeCycleEvent=function(a,d,e){trackEvent(e||config["ga.lifecycle"],a,b,d,!0)}})();
function loadScript(a,b,c,d){d=null==d?!0:d;var e=document.createElement("script");e.type="text/javascript";e.async=d;e.onload=e.onreadystatechange=function(){document.head.removeChild(e);b&&b(a)};e.onerror=function(){document.head.removeChild(e);c&&c(a)};e.src=a;document.head.appendChild(e)}
(function(){window.loadExtScript=function(a,b,c,d){if("dev"==user["remote.mode"]){var e="/content/remote/"+a+".js";setTimeout(function(){loadScript(e,b,c,d)},500)}else e=config["remote.bucket"],e+="/ch/v"+config["remote.version"]+"/"+config.label+"/"+a+".js?"+(new Date).getTime(),loadScript(e,b,c,d)}})();
function loadResource(a,b){try{var c=new XMLHttpRequest;c.open("GET",utils.getURL(a),!1);c.send();return"xml"==b?c.responseXML:"text"==b?c.responseText:JSON.parse(c.responseText)}catch(d){console.log(d)}}
(function(a){function b(a,b,e){1===arguments.length&&"function"===typeof arguments[0]&&(e=arguments[0],b=a=null);2===arguments.length&&"object"===typeof arguments[0]&&"function"===typeof arguments[1]&&(a=arguments[0],e=arguments[1],b=null);if(void 0===e)throw"An iterator must be specified";"string"!==typeof b&&(b="data-labels");window.jQuery&&a instanceof jQuery&&(a=a.get(0));void 0==a&&(a=document);var f=a.querySelectorAll(".i18n");Array.prototype.forEach.call(f,function(a){if(a.hasAttribute(b)){var c=
a.getAttribute(b);c.trim&&(c=c.trim());c.split(" ").forEach(function(b){var c=b.split("#");b=c[0];var c=c[1],d=e(c);"string"!==typeof d&&(d="");d.trim&&c.trim();if(d&&"innertext"==b.toLowerCase())try{a.innerText=d}catch(f){console.log(f)}else if(d&&"innerhtml"==b.toLowerCase())try{a.innerHTML=d}catch(h){console.log(h)}else d&&a.setAttribute(b,d)})}})}window.i18n={template:function(a){b(a,function(a){return utils.getMessage(a)})},translate:function(a,b){var e=utils.getMessage(a.toLowerCase().replace(/\s|\,/g,
""));return""!=e?e:b}}})(jQuery);(function(){window.service=function(a,b){if(void 0!=chrome.extension.getBackgroundPage())chrome.runtime.getBackgroundPage(function(c){b(c[a])});else var c=0,d=setInterval(function(){c++;5<c&&clearInterval(d);void 0!=chrome.extension.getBackgroundPage()&&(clearInterval(d),chrome.runtime.getBackgroundPage(function(c){b(c[a])}))},500)}})();
(function(a,b){var c=[],d=[],e=[],f=[],g=110;a(document).ready(function(){function h(){null!=c&&null!=d&&null!=e&&m()}function k(){var b=4*(Math.floor(a("#gallery-sites").height()/g)+1),c=[];0!=f.length&&(c=f.length>b?f.splice(0,b):f.splice(0,f.length),b=Mustache.render(p.site,c),a("#gallery-sites").append(b),c.forEach(function(b){var c=new Image;c.onload=function(b){return function(){a("div#"+b+" .logo").css("background-image","url("+c.src+")");a("div#"+b).removeClass("loading");a("div#"+b).hasClass("selected")||
a("div#"+b).addClass("available")}}(b.id);c.onerror=function(b){return function(){a("div#"+b).removeClass("loading").addClass("error")}}(b.id);c.src=n+b.img}))}function m(){var c=user["favorites.gallery.country"],d=user["favorites.gallery.category"];f=b.filter(e,function(a){return-1<a.cats.indexOf(d)&&(-1<a.country.indexOf(c)||-1<a.country.indexOf("global"))});a("#gallery-sites").empty();k()}function l(){var c=user["favorites.gallery.country"],e=user["favorites.gallery.category"],f=b.filter(d,function(a){return-1<
a.groups.indexOf("global")||-1<a.groups.indexOf(c)});a(d).each(function(){this.title=i18n.translate("gallery_cat_"+this.id,this.title)});f=Mustache.render(p.categories,f);a("#categories").empty().append(f);a("#"+e).addClass("selected");a(".category").click(function(){a(".category").removeClass("selected");a(this).addClass("selected");var b=this.id;user["favorites.gallery.category"]=b;m();trackUserEvent("gallery","cateogry",b)})}var n=config.image_request_url,p=function(){var b={};a.ajax({url:"/skin/gallery/gallery_templates.html",
async:!1,dataType:"html"}).success(function(c){c=a(c);b={countries:c.filter("#template_country").html(),shelf:c.filter("#template_shelf").html(),categories:c.filter("#template_cats").html(),site:c.filter("#template_site").html(),tags:c.filter("#template_tag").html()}});return b}();a(this).on("click",".gallery.site.available",function(){var b=[],c=a(this);b.push({name:c.data("name"),url:c.data("uri"),color:c.data("color"),thumb:n+c.data("thumb")});window.parent.postMessage({type:"add",payload:JSON.stringify(b)},
"*")});a(this).on("click",".shelf.site",function(){a("#"+a(this).data("id")).removeClass("selected").addClass("available");a(this).remove();a(".shelf.empty").show();a("#gallery-overlay").hide()});var q=window.parent.newtab.getPlugin("fav-add").getActiveGroupID();a("#save").click(function(){var b=[];a(".shelf.site").each(function(){var c={name:a(this).data("name"),url:a(this).data("uri"),thumb:a(this).data("thumb"),color:a(this).data("color")};b.push(c)});window.parent.postMessage({type:"add",payload:JSON.stringify(b)},
"*")});var r=config.api_request_url,u=r+"json_data/countries.json",v=r+"json_data/cats.json",w=r+"json_data/sites.json";(function(){a.getJSON(u,function(d){d=JSON.stringify(d);d=sd.ddd("foxtabsd",d);d=JSON.parse(d);var e=user["favorites.gallery.country"];c=b.reject(d,function(a){e==a.code&&(a.selected=!0);return"global"===a.code});d=Mustache.render(p.countries,c);a("#countries").empty().append(d);h();a("select[name=country]").change(function(){var b=a(this).val();user["favorites.gallery.country"]=
b;l();m();trackUserEvent("gallery","country",b)})})})();(function(){a.getJSON(v,function(a){a=JSON.stringify(a);a=sd.ddd("foxtabsd",a);d=a=JSON.parse(a);l();h()})})();(function(){a.getJSON(w,function(a){a=JSON.stringify(a);a=sd.ddd("foxtabsd",a);a=JSON.parse(a);service("favorites",function(c){c.get(q,function(c){var d=b.pluck(c,"url");e=b.map(a,function(a){if(-1!==b.indexOf(d,a.uri+"/")||-1!==b.indexOf(d,a.uri))a.selected=!0;return a});h()})})})})();(function(){a("#gallery-sites").scroll(function(a){a=
a.currentTarget;a.scrollHeight-a.clientHeight==a.scrollTop&&k()})})()})})(jQuery,_);
